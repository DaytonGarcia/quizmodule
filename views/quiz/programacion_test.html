{{extend 'template.html'}}
<script type="text/javascript" src="{{=URL('static','js/quiz-js/super.js')}}"></script>
<script type="text/javascript">
$(document).ready(
      
      function(){

        function isValidDate(dateString)
        {
            // revisar el patrón
            if(!/^\d{4}\-\d{1,2}\-\d{1,2}$/.test(dateString))
                return false;

            // convertir los numeros a enteros
            var parts = dateString.split("/");
            var day = parseInt(parts[2], 10);
            var month = parseInt(parts[1], 10);
            var year = parseInt(parts[0], 10);

            // Revisar los rangos de año y mes
            if( (year < 1000) || (year > 3000) || (month == 0) || (month > 12) )
                return false;

            var monthLength = [ 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 ];

            // Ajustar para los años bisiestos
            if(year % 400 == 0 || (year % 100 != 0 && year % 4 == 0))
                monthLength[1] = 29;

            // Revisar el rango del dia
            return day > 0 && day <= monthLength[month - 1];
        };
	
	$('#cboCategoria').change(function(){

        
        
        if($('#cboCategoria').val() !=0)
        {
            var idCategoria = $('#cboCategoria').val();
            var idCurso = $('#pProject').text();
            var idPeriodo = $('#pPeriod').text();

            var parametros = "?project="+idCurso+"&period="+idPeriodo+"&categorie="+idCategoria;
		    //window.location.href = "https://"+document.domain+"/quiz/test"+parametros;
            var result = submitLoad("quiz","getActivities",parametros);
            var data = JSON.parse(result);
            $('#cboActividad option').remove();
            $('#cboActividad').append($('<option>', { 
                    value: 0,
                    text : 'Seleccione una actividad' 
                }));

            for (var i in data) {

                $('#cboActividad').append($('<option>', { 
                    value: data[i]['id'],
                    text : data[i]['name'] 
                }));
                
                
             }
        }
		
    });


    $('#btGrabar').click(function()
    {
        alert( $("#dateInit").text());
        alert( isValidDate($("#dateInit").text()) );

        if($('#cboCategoria option:selected').val()==0)
        {
            alert('Por favor seleccione una categoria');
        }

        else if($('#cboActividad option:selected').val()==0)
        {
            alert('Por favor seleccione una actividad');
        }
        

    }

    );
});


</script>
</head>
<div class="row-fluid">
	<center>
	    <h2>Programacion de Evaluacion: {{ =metadata.tb_metadata_quiz.nombre }}
	    	{{if (auth.has_membership('Super-Administrator') == False )and (auth.has_membership('Ecys-Administrator') == False) :}}
	    	<a onclick="javascript:introJs().setOptions({ 'skipLabel': '{{=T('Skip')}}', 'nextLabel': '{{=T('Next')}}', 'prevLabel': '{{=T('Previous')}}', 'doneLabel': '{{=T('Exit')}}' }).start();" href='javascript:void(0);' class="btn btn-primary" >
			  <span class="icon-white icon-question-sign"></span>
			</a>
			{{pass}}
			<br>
        </h2>
	</center>
</div>
<br>
<div class="navbar" data-step=1 data-intro="Div para informacion del quiz">
    <div class="navbar-inner">
        <a style="cursor:pointer;"><center><h4>Informacion general de la evaluacion</h4></center></a>
    </div>
</div>
<div class="well" id="div_metainfo_quiz">
<p><strong>Creador:</strong> {{=metadata.auth_user.first_name}} {{=metadata.auth_user.last_name}}</p> 
<p><strong>Curso: </strong>  {{=metadata.project.name}}</p>
<p><strong>Fecha de creacion: </strong>  {{=metadata.tb_metadata_quiz.fecha_creacion}}</p></p>
</div>

<div class="navbar" data-step=1 data-intro="Div para programacion">
        <div class="navbar-inner">
            <a style="cursor:pointer;"><center><h4>Creacion de programacion para la actividad tipo evaluacion</h4></center></a>
        </div>
</div>
<div class="well" id="div_metainfo_quiz">
    <table width="100%">
        <tr>
            <td width="20%">
                    <p><strong>Categoria de actividades:</strong></p>
            </td>
            <td width="30%">
                    <select id="cboCategoria">
                            <option value="0">Seleccion una categoria</option>
                            {{for categoria in categorias:}}
                            <option value="{{=categoria.id}}">{{=categoria.category}}</option>
                            {{pass}}
                    </select>
            </td>
            <td width="20%">
                    <p><strong>Seleccione una actividad:</strong></p>

            </td>
            <td width="30%">
                    <select id="cboActividad">
                            <option value="0">Seleccione una actividad</option>
                    </select>
            </td>

        </tr>
        <tr>
            <td width="20%">
                    <p><strong>Fecha de ejecucion:</strong></p>
            </td>
            <td width="30%">
                    <input class="date" id="dateInit" name="log-date" placeholder="YYYY-MM-DD" type="text" value="" style="width:64%;" autocomplete="off">
            </td>
            <td width="20%">
                    <p><strong>Horario de ejecucion:</strong></p>
            </td>
            <td width="20%">
                    <input id="inpHora" name="hora" placeholder="HH:MM" type="time" value="" style="width:64%;" autocomplete="off">
            </td>
        </tr>
        <tr>
            <td width="20%">
                <p><strong>Duracion en minutos:</strong></p>
            </td>
            <td width="30%"> 
                <input id="txtDuracion" placeholder="mins" type="text" style="width:64%;">
            </td>
            <td width="20%">
            </td>
            <td width="30%">
                    <button id="btGrabar" type="button" class="btn btn-success">Grabar Programacion</button>
            </td>
        </tr>
    </table>

</div>
<p id="pPeriod" hidden value="{{=periodo.id}}">{{=periodo.id}}</p>
<p id="pProject" hidden value="{{=project.id}}">{{=project.id}}</p>